<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>4.5 Background Jobs</title>
    <script src="https://cdn.tailwindcss.com"></script>
  </head>
  <body>
    <div id="app"></div>

    <script type="module">
      import ui from "/ui.js";

      ui.app("Background Jobs")
        .blurb("Create a job, then poll for status and result.")
        .section("Create job")
          .action("Create job")
            .post("/jobs")
            .field("input", "reverse me")
            .store({ jobId: "data.id" })
            .refreshAll()
            .end()
          .action("Refresh list").get("/jobs").store({ jobs: "data" }).refreshAll().end()
          .end()
        .section("Latest jobs")
          .read("/jobs")
          .store({ jobs: "data" })
          .listFrom("jobs")
          .list("#{{id}} · {{status}} · input={{input}} · result={{result}}")
          .meta("{{count}} jobs", "jobs")
          .end()
        .section("Check job by ID")
          .fields({ jobId: { value: 1 } })
          .action("Check")
            .get("/jobs/{{jobId}}")
            .store({ jobDetail: "data" })
            .end()
          .end()
        .section("Job detail")
          .listFrom("jobDetail")
          .list("id={{id}} · status={{status}} · input={{input}} · result={{result}}")
          .end()
        .mount();
    </script>
  </body>
</html>
